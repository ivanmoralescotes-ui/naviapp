<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Subir archivo</title>
</head>
<body>
  <h1>Procesar archivo</h1>

  <!-- Campo para seleccionar archivo -->
  <div>
    <label for="archivo">Selecciona un archivo:</label>
    <input type="file" id="archivo" />
  </div>

  <!-- Campo para escribir la palabra -->
  <div style="margin-top: 10px;">
    <label for="palabra">Escribe la clave:</label>
    <input type="text" id="clave" placeholder="Escribe la clave aqu铆" />
  </div>

  <br>
  <label for="miLista">Elige una opci贸n:</label>
  <select id="miLista" name="miLista">
    <option value="1">1</option>
    <option value="2">2</option>
	<option value="3">3</option>
  </select>
  
  <!-- Bot贸n para ejecutar tu c贸digo -->
  <div style="margin-top: 20px;">
    <button id="subir" type="button" >Ejecutar c贸digo</button>
  </div>
   <br>
   <pre id="resultado"></pre>
  <script>
    
	var ghubt = "";
	//atob("2l0aHViX3BhdF8xMUJZQ09GSVEwVkRCaXNpMTFzdk1CX1g4dEtyZGYyZ0tMQWRiVEQzODZlN1ZDZUNGRHlQTXkzbGtjVjVESU10VXVURFJNWDJFSUtpbFF6bWpD"); // <-- pon aqu铆 tu PAT
  const OWNER = "ivanmoralescotes-ui";
  const REPO = "naviapp";
  const BRANCH = "main"; // 
	
	// Convierte ArrayBuffer a base64 (lo que exige la API de GitHub)
  function arrayBufferToBase64(buffer) {
    let binary = "";
    const bytes = new Uint8Array(buffer);
    const len = bytes.byteLength;
    for (let i = 0; i < len; i++) {
      binary += String.fromCharCode(bytes[i]);
    }
    return btoa(binary);
  }
	
    //function procesarImagen() {
	document.getElementById("subir").addEventListener("click", async () => {
      // Obtenemos el archivo y la palabra desde el HTML
      const inputArchivo = document.getElementById('archivo');
      const inputPalabra = document.getElementById('clave');

      const file = inputArchivo.files[0];   // Archivo seleccionado
      const palabra = inputPalabra.value;      // Palabra escrita

      // --- Ejemplo de uso (puedes borrar esto si quieres) ---
      console.log('Archivo seleccionado:', file);
      console.log('Palabra ingresada:', palabra);

      //  Aqu铆 dentro usa "archivo" y "palabra" con el c贸digo que ya tienes.
      // Por ejemplo:
      // miFuncionDeProcesamiento(archivo, palabra);
	  
	  if (!file) {
        alert("Primero selecciona un archivo.");
        return;
      }
	  
	  try {
      // Leemos el archivo como ArrayBuffer
      const arrayBuffer = await file.arrayBuffer();
      const base64Content = arrayBufferToBase64(arrayBuffer);

      // Ruta dentro del repo: /naviapp/{nombreArchivo}
      //const pathInRepo = `naviapp/${file.name}`;//naviapp
	  const pathInRepo = `naviapp/11121443/tem.jpg`;

      const url = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${encodeURIComponent(pathInRepo)}`;

      const body = {
        message: `Subir archivo ${file.name} desde formulario HTML`,
        content: base64Content,
        branch: BRANCH
      };







        // Hacemos una petici贸n a la funci贸n serverless
        fetch('/.netlify/functions/getTheToken')
            .then(response => response.json())
            .then(data => {
                console.log('Token recibido:', data.token);
                // Aqu铆 podr铆as hacer algo con el token o con los datos que te devuelva la funci贸n serverless.
			      ghubt=data.token;
							
				  const response = await fetch(url, {
					method: "PUT",
					headers: {
					  "Authorization": `Bearer ${ghubt}`,
					  "Accept": "application/vnd.github+json"
					},
					body: JSON.stringify(body)
				  });

				  const data = await response.json();
				  document.getElementById("resultado").textContent = JSON.stringify(data, null, 2);

				  if (!response.ok) {
					alert("Hubo un error subiendo el archivo. Revisa la consola o el <pre>.");
				  } else {
					alert("Archivo subido correctamente a GitHub ");
				  }		
				
				
            })
            .catch(error => console.error('Error al invocar la funci贸n:', error));
			
			



      
    } catch (error) {
      console.error(error);
      alert("Error inesperado al subir el archivo.");
    }
	  
	  
   });
  </script>
</body>
</html>
